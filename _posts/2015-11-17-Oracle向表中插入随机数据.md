---
layout: post
author: liwenbin1991
title: 使用SQL向表中插入随机的数据来构造实验数据
category: 技术博文
tag: [SQL]
---

这是逗逼根提出的一个想法，这个需求用java很容易就实现了，不过既然要使用sql，所以就试一下。

##要求：

1. 每一列的值是随机出现的
2. 时间和日期是在一个范围里面随机的产生的
3. 因为每一列都是随机出现的，所以最后生成的行数据是都是随机的
4. 还好没有要求某一列的某个值只能和另一列的某些值进行组合

###以下是最后的结果，当然过程不是一蹴而就的

* 字符串列的随机
	这个我采用在表中随机查询一列的方式，按道理应该创建临时表，但是测试环境，懒得麻烦了
	
	{% highlight c %}
	
	SELECT *  FROM (SELECT * FROM TAB_NAME ORDER BY DBMS_RANDOM.VALUE) WHERE ROWNUM<=1;
	
	{% endhighlight %}

* 数字随机
	这个我在dual表中利用随机函数查询随机值
	
	{% highlight c %}
	
	SELECT trunc(dbms_random.value(18,43)) FROM dual;
		
	{% endhighlight %}

* 日期随机
	这个有点难度，尤其是在时分秒上的随机
	
	{% highlight c %}
	
	SELECT TO_DATE(B,'YYYY-MM-DD HH24:MI:SS') 
	FROM (SELECT TO_CHAR(A,'YYYY-MM-DD HH24:MI:SS') B 
	      FROM (SELECT TO_DATE(TRUNC(DBMS_RANDOM.VALUE(TO_NUMBER (TO_CHAR (TO_DATE('2015-11-04 00:00:00','YYYY-MM-DD HH24:MI:SS'),'J')),
							   TO_NUMBER (TO_CHAR (TO_DATE('2015-11-10 23:59:59','YYYY-MM-DD HH24:MI:SS'),'J'))
							  )
					),'J'
				  )+
			    (TRUNC(DBMS_RANDOM.VALUE(9,17))*3600+TRUNC(DBMS_RANDOM.VALUE(0,60))*60 + 
			     TRUNC(DBMS_RANDOM.VALUE(0,60)))/(24*60*60) A FROM DUAL
		   )
	     );
	
	{% endhighlight %}


==================================
####表结构
	{% highlight c %}

DROP TABLE "DEVUSER"."WARNING_AUTO_ALARM";
CREATE TABLE "DEVUSER"."WARNING_AUTO_ALARM" (
"ID" NUMBER NOT NULL ,
"DEPART_ID" NUMBER NULL ,
"NAME" VARCHAR2(100 BYTE) NULL ,
"WARNING_LEVEL" VARCHAR2(20 BYTE) NULL ,
"WARNING_TYPE" VARCHAR2(100 BYTE) NULL ,
"WARING_DATE" DATE NULL ,
"BUSINESS_PROJECT" VARCHAR2(100 BYTE) NULL ,
"LONGITUDE" NUMBER(9,6) NULL ,
"LATITUDE" NUMBER(9,6) NULL ,
"MONITOR_LAYER_NAME" VARCHAR2(100 BYTE) NULL ,
"MONITOR_ID" NUMBER NULL ,
"IS_CANCLE" NUMBER(1) DEFAULT 0  NULL ,
"CANCLE_REASON" VARCHAR2(1000 BYTE) NULL ,
"IS_UPGRADE_EVENT" NUMBER(1) DEFAULT 0  NULL ,
"UPGRADE_EVENT_ID" NUMBER NULL ,
"UPDATE_TIME" TIMESTAMP(6)  DEFAULT SYSTIMESTAMP  NULL 
)
LOGGING
NOCOMPRESS
NOCACHE
;

	{% endhighlight %}

####ID列的触发器
	{% highlight c %}

CREATE OR REPLACE TRIGGER "DEVUSER"."TIB_WARNING_AUTO_ALARM" BEFORE INSERT ON "DEVUSER"."WARNING_AUTO_ALARM" REFERENCING OLD AS "OLD" NEW AS "NEW" FOR EACH ROW ENABLE
declare
    integrity_error  exception;
    errno            integer;
    errmsg           char(200);
    dummy            integer;
    found            boolean;

begin
    --  Column "ID" uses sequence SEQ_WARNING_AUTO_ALARM
    select SEQ_WARNING_AUTO_ALARM.NEXTVAL INTO :new.ID from dual;

--  Errors handling
exception
    when integrity_error then
       raise_application_error(errno, errmsg);
end;
	{% endhighlight %}

####脚本主体
	{% highlight c %}

rem NAME 列 ,自己再添加很多名字
CREATE TABLE TAB_NAME(NAME VARCHAR2(100 BYTE));
INSERT INTO TAB_NAME VALUES( '火灾报警');
INSERT INTO TAB_NAME VALUES('网络故障');
INSERT INTO TAB_NAME VALUES('景区客流超标');
INSERT INTO TAB_NAME VALUES('反腐倡廉话题');
INSERT INTO TAB_NAME VALUES('乘客携带危险品');
INSERT INTO TAB_NAME VALUES('山体滑坡');
INSERT INTO TAB_NAME VALUES('矿山地压监测');
INSERT INTO TAB_NAME VALUES('网络交易超标');
INSERT INTO TAB_NAME VALUES('工厂设备氯气泄漏');

rem WARNING_TYPE 列
CREATE TABLE TAB_WARNING_TYPE(WARNING_TYPE VARCHAR2(100 BYTE));
INSERT INTO TAB_WARNING_TYPE VALUES('异常报警');
INSERT INTO TAB_WARNING_TYPE VALUES('故障报警');

rem WARNING_LEVEL 列
CREATE TABLE TAB_WARNING_LEVEL("WARNING_LEVEL" VARCHAR2(20 BYTE) NULL);
INSERT INTO TAB_WARNING_LEVEL VALUES('Ⅰ');
INSERT INTO TAB_WARNING_LEVEL VALUES('Ⅱ');
INSERT INTO TAB_WARNING_LEVEL VALUES('Ⅲ');
INSERT INTO TAB_WARNING_LEVEL VALUES('Ⅳ');

REM SELECT *  FROM (SELECT * FROM TAB_WARNING_LEVEL ORDER BY DBMS_RANDOM.VALUE) WHERE ROWNUM<=1;

rem WARING_DATE 列
rem select to_date(b,'yyyy-mm-dd hh24:mi:ss') from (select to_CHAR(a,'yyyy-mm-dd hh24:mi:ss') b from (SELECT TO_DATE(TRUNC (DBMS_RANDOM.VALUE (TO_NUMBER (TO_CHAR (to_date('2015-11-04 00:00:00','YYYY-MM-DD HH24:MI:SS'),'J')),TO_NUMBER (TO_CHAR (to_date('2015-11-10 23:59:59','YYYY-MM-DD HH24:MI:SS'), 'J')))),'J' )+ (TRUNC(DBMS_RANDOM.VALUE(9,17))*3600+TRUNC(DBMS_RANDOM.VALUE(0,60))*60 + TRUNC(DBMS_RANDOM.VALUE(0,60)))/(24*60*60) a FROM DUAL));


rem BUSINESS_PROJECT
CREATE TABLE TAB_BUSINESS_PROJECT(BUSINESS_PROJECT VARCHAR2(100 BYTE));
INSERT INTO TAB_BUSINESS_PROJECT VALUES('公共安全');
INSERT INTO TAB_BUSINESS_PROJECT VALUES('基础设施');
INSERT INTO TAB_BUSINESS_PROJECT VALUES('旅游专题');
INSERT INTO TAB_BUSINESS_PROJECT VALUES('舆情民生');
INSERT INTO TAB_BUSINESS_PROJECT VALUES('环境污染');
INSERT INTO TAB_BUSINESS_PROJECT VALUES('交通出行');

	{% endhighlight %}
       

	{% highlight c %}

rem 插入主体程序
DECLARE
	--需要插入的条数,10000是我乱写的，自己改哟
	TI  INTEGER :=10;
BEGIN
	FOR I IN 1 .. TI
	LOOP
		INSERT INTO WARNING_AUTO_ALARM(id,DEPART_ID,NAME,WARNING_LEVEL,WARNING_TYPE,WARING_DATE,BUSINESS_PROJECT,LONGITUDE,LATITUDE,MONITOR_LAYER_NAME,MONITOR_ID,IS_CANCLE,CANCLE_REASON,IS_UPGRADE_EVENT,UPGRADE_EVENT_ID) 
		select ID_GENB.NEXTVAL,
		(SELECT trunc(dbms_random.value(18,43)) FROM dual),
		(SELECT *  FROM (SELECT * FROM TAB_NAME ORDER BY DBMS_RANDOM.VALUE) WHERE ROWNUM<=1),
		(SELECT *  FROM (SELECT * FROM TAB_WARNING_LEVEL ORDER BY DBMS_RANDOM.VALUE) WHERE ROWNUM<=1),
		(SELECT *  FROM (SELECT * FROM TAB_WARNING_TYPE ORDER BY DBMS_RANDOM.VALUE) WHERE ROWNUM<=1),
		(SELECT TO_DATE(B,'YYYY-MM-DD HH24:MI:SS') FROM (SELECT TO_CHAR(A,'YYYY-MM-DD HH24:MI:SS') B FROM (SELECT TO_DATE(TRUNC (DBMS_RANDOM.VALUE (TO_NUMBER (TO_CHAR (TO_DATE('2015-11-04 00:00:00','YYYY-MM-DD HH24:MI:SS'),'J')),TO_NUMBER (TO_CHAR (TO_DATE('2015-11-10 23:59:59','YYYY-MM-DD HH24:MI:SS'), 'J')))),'J' )+ (TRUNC(DBMS_RANDOM.VALUE(9,17))*3600+TRUNC(DBMS_RANDOM.VALUE(0,60))*60 + TRUNC(DBMS_RANDOM.VALUE(0,60)))/(24*60*60) A FROM DUAL))),
		 (SELECT *  FROM (SELECT * FROM TAB_BUSINESS_PROJECT ORDER BY DBMS_RANDOM.VALUE) WHERE ROWNUM<=1),
		 (SELECT trunc(dbms_random.value(90,110)) FROM dual),
		 (SELECT trunc(dbms_random.value(25,40)) FROM dual),
		 NULL,
		 NULL,
		 0
		from dual;
	END LOOP;
END;

	{% endhighlight %}











